# 创建一个字典来存储错误码和对应的错误信息
error_map = {
    'R_0000': '查验成功，发票一致',
    '0': '查验成功，发票一致',
    '0000': '查验成功，发票一致',
    '0001': '查验成功，发票一致',
    '121800': '查验成功，发票一致',
    '1': '查验成功，发票一致',
    'R_0001': '该发票今日已超过税局规定的查验次数（5次），请明日再试',
    '002': '该发票今日已超过税局规定的查验次数（5次），请明日再试',
    '0002': '该发票今日已超过税局规定的查验次数（5次），请明日再试',
    '121801': '该发票今日已超过税局规定的查验次数（5次），请明日再试',
    '402': '该发票今日已超过税局规定的查验次数（5次），请明日再试',
    'CheckInvoiceMoreFiveTimes': '该发票今日已超过税局规定的查验次数（5次），请明日再试',
    '2': '该发票今日已超过税局规定的查验次数（5次），请明日再试',
    'R_0002': '查验失败，查验所需参数与发票票面不一致',
    '6': '查验失败，查验所需参数与发票票面不一致',
    '0006': '查验失败，查验所需参数与发票票面不一致',
    '121802': '查验失败，查验所需参数与发票票面不一致',
    '406': '查验失败，查验所需参数与发票票面不一致',
    '006': '查验失败，查验所需参数与发票票面不一致',
    'CheckInvoiceNotSame': '查验失败，查验所需参数与发票票面不一致',
    'R_0003': '税局没有查到该发票',
    'CY0018': '税局没有查到该发票',
    '9': '税局没有查到该发票',
    '0009': '税局没有查到该发票',
    '121803': '税局没有查到该发票',
    '409': '税局没有查到该发票',
    '009': '税局没有查到该发票',
    'CheckInvoiceNotExistence': '税局没有查到该发票',
    'R_0004': '发票抬头不在查询范围内',
    '10023': '发票抬头不在查询范围内',
    '121804': '发票抬头不在查询范围内',
    '1000': '发票抬头不在查询范围内',
    'R_0005': '不能查验5年前的发票',
    '7777': '不能查验5年前的发票',
    '1015': '不能查验5年前的发票',
    '121805': '不能查验5年前的发票',
    'R_0006': '当日发票暂未进入国税系统，请1小时后再试',
    '6666': '当日发票暂未进入国税系统，请1小时后再试',
    '1014': '当日发票暂未进入国税系统，请1小时后再试',
    '121806': '当日发票暂未进入国税系统，请1小时后再试',
    'rqerr': '当日发票暂未进入国税系统，请1小时后再试',
    '12001': '当日发票暂未进入国税系统，请1小时后再试',
    'R_0007': '发票类型不支持',
    '121807': '发票类型不支持',
    'R_0064': '企业发票查验张数已超订单限额，请联系管理员',
    '1004': '企业发票查验张数已超订单限额，请联系管理员',
    '121808': '企业发票查验张数已超订单限额，请联系管理员',
    '-97': '企业发票查验张数已超订单限额，请联系管理员',
    'CheckExceedingLimit': '企业发票查验张数已超订单限额，请联系管理员',
    'R_0013': '发票代码、号码不规范，请检查和发票票面是否一致',
    '105': '发票代码、号码不规范，请检查和发票票面是否一致',
    '1005': '发票代码、号码不规范，请检查和发票票面是否一致',
    '126105': '发票代码、号码不规范，请检查和发票票面是否一致',
    '081': '发票代码、号码不规范，请检查和发票票面是否一致',
    'CheckInvoiceNotStandard': '发票代码、号码不规范，请检查和发票票面是否一致',
    '082': '发票代码、号码不规范，请检查和发票票面是否一致',
    'R_0030': '当前查验未完成，请稍后',
    '1010': '当前查验未完成，请稍后',
    '121710': '当前查验未完成，请稍后',
    'R_0031': '该批次已查验',
    '1011': '该批次已查验',
    '126106': '该批次已查验',
    'R_0032': '批次号不存在',
    '1013': '批次号不存在',
    '126107': '批次号不存在',
    'R_0026': '参数不能为空',
    '1008': '参数不能为空',
    '121708': '参数不能为空',
    '704': '参数不能为空',
    'R_0045': '请求参数有误',
    '122017': '请求参数有误',
    '1016': '请求参数有误',
    '005': '请求参数有误',
    '-94': '请求参数有误',
    '505019': '请求参数有误',
    '3111': '请求参数有误',
    '084': '请求参数有误',
    '083': '请求参数有误',
    'R_0047': '参数错误或查验次数超过上限',
    '122000': '参数错误或查验次数超过上限',
    'R_0048': '国税不支持查验该发票或发票代码填写有误',
    '122015': '国税不支持查验该发票或发票代码填写有误',
    '1019': '国税不支持查验该发票或发票代码填写有误',
    '499': '国税不支持查验该发票或发票代码填写有误',
    'R_0049': '不支持查询该地区发票',
    '122002': '不支持查询该地区发票',
    '498': '不支持查询该地区发票',
    '018': '不支持查询该地区发票',
    'R_0050': 'IP不在授权范围内',
    '122003': 'IP不在授权范围内',
    'R_0051': '不能操作该税号',
    '122004': '不能操作该税号',
    '104': '不能操作该税号',
    'R_0052': '不能操作该发票',
    '122005': '不能操作该发票',
    'R_0053': '获取发票全票面，查验成功，信息不完整',
    '122006': '获取发票全票面，查验成功，信息不完整',
    '231': '获取发票全票面，查验成功，信息不完整',
    'R_0054': '获取发票全票面，查验成功，信息有误',
    '122007': '获取发票全票面，查验成功，信息有误',
    '232': '获取发票全票面，查验成功，信息有误',
    'R_0055': '参数错误',
    '122016': '参数错误',
    'R_10020': '发票代码错误',
    '122026': '发票代码错误',
    '013': '发票代码错误',
    'IllegalParameter.IllegalInvoiceCode': '发票代码错误',
    'R_10021': '发票号码错误',
    '122020': '发票号码错误',
    '014': '发票号码错误',
    'IllegalParameter.IllegalInvoiceNumber': '发票号码错误',
    'R_10022': '开票日期错误',
    '122021': '开票日期错误',
    '015': '开票日期错误',
    'CheckInvoicesMoreThanToday': '开票日期错误',
    'R_10023': '金额合计错误',
    '122024': '金额合计错误',
    'IllegalParameter.IllegalTotalAmount': '金额合计错误',
    'R_10024': '价税合计错误',
    '122025': '价税合计错误',
    'R_0056': '请求不合法',
    '122008': '请求不合法',
    '405': '请求不合法',
    'IllegalParameter': '请求不合法',
    'R_0057': '获取发票全票面，查验成功，不属于当前公司',
    '122009': '获取发票全票面，查验成功，不属于当前公司',
    '233': '获取发票全票面，查验成功，不属于当前公司',
    'R_0058': '税号为空或不存在',
    '122010': '税号为空或不存在',
    '513': '税号为空或不存在',
    'R_0059': '税号不存在',
    '122011': '税号不存在',
    '703': '税号不存在',
    'R_0060': '未开通进项发票服务，请开通后使用',
    '122012': '未开通进项发票服务，请开通后使用',
    '910': '未开通进项发票服务，请开通后使用',
    'R_0061': '未开通查验服务，请开通再进行查验',
    '122013': '未开通查验服务，请开通再进行查验',
    '907': '未开通查验服务，请开通再进行查验',
    'R_0062': '非本公司发票，不能查询',
    '122014': '非本公司发票，不能查询',
    '12355@0063': '请检查"发票代码、发票号码、开票日期、校验码、不含税金额"，保证和发票票面信息一致',
    '122018': '请检查"发票代码、发票号码、开票日期、校验码、不含税金额"，保证和发票票面信息一致',
    'R_9999': '税局系统不稳定，请2小时后再试',
    '9999': '税局系统不稳定，请2小时后再试',
    '129999': '税局系统不稳定，请2小时后再试',
    '-1': '税局系统不稳定，请2小时后再试',
    '0': '税局系统不稳定，请2小时后再试',
    'CheckInvoiceException': '税局系统不稳定，请2小时后再试',
    '041': '税局系统不稳定，请2小时后再试',
    'ServerError': '税局系统不稳定，请2小时后再试',
    '021': '税局系统不稳定，请2小时后再试',
    'ServerException': '税局系统不稳定，请2小时后再试',
    '010': '税局系统不稳定，请2小时后再试',
    'CheckInvoiceSingular': '税局系统不稳定，请2小时后再试',
    '-01': '税局系统不稳定，请2小时后再试',
    'false': '税局系统不稳定，请2小时后再试',
    '012': '税局系统不稳定，请2小时后再试',
    'R_1021': '网络超时，请1小时后再试',
    'CY0035': '网络超时，请1小时后再试',
    '1021': '网络超时，请1小时后再试',
    '129998': '网络超时，请1小时后再试',
    '404': '网络超时，请1小时后再试',
    '1006': '税局系统不稳定，请2小时后再试',
    '0005': '税局系统不稳定，请2小时后再试',
    '416': '税局系统不稳定，请2小时后再试',
    '106': '税局系统不稳定，请2小时后再试',
    '1010': '税局系统不稳定，请2小时后再试',
    '411': '税局系统不稳定，请2小时后再试',
    '003': '税局系统不稳定，请2小时后再试',
    '12002': '税局系统不稳定，请2小时后再试',
    '1011': '税局系统不稳定，请2小时后再试',
    '410': '税局系统不稳定，请2小时后再试',
    '007': '税局系统不稳定，请2小时后再试',
    '11001': '税局系统不稳定，请2小时后再试',
    '3': '税局系统不稳定，请2小时后再试',
    '99': '税局系统不稳定，请2小时后再试',
    '008': '税局系统不稳定，请2小时后再试',
    '005': '税局系统不稳定，请2小时后再试',
    '501': '税局系统不稳定，请2小时后再试',
    '010_': '税局系统不稳定，请2小时后再试',
    '129997': '税局系统不稳定，请2小时后再试',
    '50014': '税局系统不稳定，请2小时后再试',
    'RemoteResultFail': '税局系统不稳定，请2小时后再试',
    '011': '税局系统不稳定，请2小时后再试',
    '0036': '税局系统不稳定，请2小时后再试',
    '-95': '税局系统不稳定，请2小时后再试', 
    '403': '税局系统不稳定，请2小时后再试',
    '59999': '税局系统不稳定，请2小时后再试',
    'CY0008': '税局系统不稳定，请2小时后再试',
    'R_10001': '开票金额：不合法的长度',
    'CY0017': '发票信息不一致',
    'CY0030': '超过该张票当天查验次数',
    'CY0030': '超过该张票当天查验次数',
    '085': '税局系统不稳定，请2小时后再试',
    '1009': '税局系统不稳定，请2小时后再试',
    '1009': '税局系统不稳定，请2小时后再试',
    '-91': '税局系统不稳定，请2小时后再试',
    '004': '税局系统不稳定，请2小时后再试',
    '020': '税局系统不稳定，请2小时后再试',
    '024': '税局系统不稳定，请2小时后再试',
    '091': '税局系统不稳定，请2小时后再试',
    'R_10003': '不存在的发票类型',
    'PJJ_10003': '不存在的发票类型',
    '121984': '不存在的发票类型',
    'R_10017': '发票类型不能为空',
    'PJJ_10017': '发票类型不能为空',
    '121995': '发票类型不能为空',
    'R_10004': '发票代码不能为空',
    'PJJ_10004': '发票代码不能为空',
    '121993': '发票代码不能为空',
    'R_10006': '发票代码长度不合法',
    'PJJ_10006': '发票代码长度不合法',
    '121994': '发票代码长度不合法',
    'R_10016': '检验码不能为空',
    'PJJ_10016': '检验码不能为空',
    '121996': '检验码不能为空',
    'R_10025': '校验码不能为空，如果为"全电纸质普票"类型，请填写票面上密码区内全电发票号码后6位',
    'R_10018': '检验码长度不合法',
    'PJJ_10018': '检验码长度不合法',
    '121997': '检验码长度不合法',
    'R_10019': '校验码错误',
    '121985': '校验码错误',
    '011': '校验码错误',
    'IllegalParameter.IllegalCheckCode': '校验码错误',
    'R_10007': '发票号码不能为空',
    'PJJ_10007': '发票号码不能为空',
    '121998': '发票号码不能为空',
    'R_10009': '发票号码长度不合法',
    'PJJ_10009': '发票号码长度不合法',
    '121999': '发票号码长度不合法',
    'R_10010': '开票日期不能为空',
    'PJJ_10010': '开票日期不能为空',
    '121980': '开票日期不能为空',
    'R_0028': '参数格式有误',
    'PJJ_10012': '参数格式有误',
    '121981': '参数格式有误',
    'R_10013': '开票金额不能为空',
    'PJJ_10013': '开票金额不能为空',
    '121982': '开票金额不能为空',
    'R_10030': '发票总金额不能为空',
    '121911': '发票总金额不能为空',
    'R_100015': '开票金额长度不合法',
    'PJJ_10015': '开票金额长度不合法',
    'DX_1009': '开票金额长度不合法',
    '126015': '开票金额长度不合法',
    'R_1022': '参数不正确',
    '126022': '参数不正确',
    '1022': '参数不正确',
    'R_11000': '发票查验无可用订单',
    '120998': '发票查验无可用订单',
    'R_11002': '',
    '120999': '',
    'R_11001': '',
    'MXG_ERROR': '墨西哥税局验证不通过，请检查发票号码、销售方税号、购买方税号是否正确',
    'CheckInvoicesOverFiveYears': '超过该张票当天查验次数',
    'CheckInvoiceForTheSameFrequent': '超过该张票当天查验次数',
    'MXG_ERROR_R_9999': '墨西哥税局不稳定，请稍后重试',
    'IllegalParameter.IllegalBillingDate': '开票日期错误',
    }


import pandas as pd
from check_order_map import error_map

# 读取CSV文件
df = pd.read_csv('map_excel/发票查验.csv')


# 创建一个全局set来存储未找到映射的错误码
unmapped_codes = set()
    
# 使用error_map转换反馈结果字段
def convert_error_code(code):
    if pd.isna(code):
        return ''
    code = str(code).strip()
    
    result = error_map.get(code, code)
    if result == code:
        unmapped_codes.add(code)
    return result

# 转换反馈结果列
df['反馈结果'] = df['反馈结果'].apply(convert_error_code)

# 保存处理后的结果
output_file = 'map_excel/发票查验_处理结果.csv'
df.to_csv(output_file, index=False, encoding='utf-8-sig')

print(f'处理完成，结果已保存到: {output_file}')

# 在程序结束时打印所有未找到映射的错误码
if len(unmapped_codes) > 0:
    print("未找到映射的错误码:")
    for code in sorted(unmapped_codes):
        print(f"- {code}")